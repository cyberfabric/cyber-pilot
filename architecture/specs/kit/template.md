---
cypilot: true
type: spec
name: Template Specification
version: 1.0
purpose: Define the format, generation algorithm, and usage of generated template.md files
drivers:
  - cpt-cypilot-fr-core-blueprint
  - cpt-cypilot-component-blueprint-processor
---

# Template Specification (template.md)

---

## Table of Contents

- [Template Specification (template.md)](#template-specification-templatemd)
  - [Overview](#overview)
  - [Location](#location)
  - [Source Markers](#source-markers)
  - [Generation Algorithm](#generation-algorithm)
  - [File Format](#file-format)
  - [Placeholder Variables](#placeholder-variables)
  - [Example](#example)
  - [Usage](#usage)
  - [Error Handling](#error-handling)

---

## Overview

`template.md` is a **generated** output file that provides the clean heading structure for an artifact kind. It is produced by the Blueprint Processor by walking `@cpt:heading` markers, emitting headings, including `@cpt:prompt` writing instructions, and stripping all other metadata markers.

**Key properties**:
- Generated from blueprint — do not edit manually
- Clean Markdown with no `@cpt:` markers
- Contains heading structure with `{placeholder}` variables
- Used by generate workflows as structural reference for artifact creation
- Regenerated by `cypilot generate-resources`

---

## Location

**Per-artifact**: `config/kits/<slug>/artifacts/<KIND>/template.md`

---

## Source Markers

| Marker | Role |
|--------|------|
| `@cpt:heading` | Each heading marker emits one Markdown heading using its `template` key |
| `@cpt:prompt` | Writing instruction placed under the preceding heading |

All other markers (`@cpt:rule`, `@cpt:example`, `@cpt:id`, etc.) are **stripped** during generation.

See [blueprint.md spec](blueprint.md) for full marker reference.

---

## Generation Algorithm

1. Walk all `@cpt:heading` blocks in order.
2. For each heading:
   - Emit a Markdown heading at the declared `level` (number of `#` symbols).
   - Use the `template` TOML key as heading text. If `template` is absent, use the `pattern` key as a human-readable fallback.
   - If `numbered = true`, prepend numbering prefix consistent with heading hierarchy.
3. For each `@cpt:prompt` following a heading, emit the prompt content under the heading as a writing instruction.
4. Strip all other marker blocks between headings (`@cpt:rule`, `@cpt:example`, `@cpt:id`).
5. Collapse resulting blank lines (max 2 consecutive).
6. Result is `template.md`.

**Determinism guarantee**: same blueprint → identical `template.md` (byte-for-byte).

---

## File Format

A valid `template.md` is a pure Markdown file containing only headings and optional placeholder text:

```markdown
# PRD — {Title of product}

## 1. Overview

### 1.1 Purpose

### 1.2 Background / Problem Statement

### 1.3 Goals (Business Outcomes)

## 2. Functional Requirements

## 3. Non-functional Requirements

## 4. Actors & Use Cases

### 4.1 Actors

### 4.2 Use Cases
```

**Rules**:
- Each heading corresponds to one `@cpt:heading` marker in the blueprint
- Heading levels match the `level` TOML key
- Numbered headings include numbering prefixes consistent with their hierarchy
- `{placeholder}` variables appear in heading text where the blueprint's `template` key includes them
- No other content between headings (body content is for the user to fill in)

---

## Placeholder Variables

Placeholders use the `{name}` format in heading text:

```markdown
# PRD — {Title of product}
```

- Placeholders are preserved literally in `template.md`
- Generate workflows replace placeholders with actual values during artifact creation
- The text inside `{...}` serves as the writing prompt — it tells the author what to fill in

---

## Example

Given a blueprint with these headings:

```toml
# @cpt:heading
id = "prd-h1-title"
level = 1
template = "PRD — {Title of product}"

# @cpt:heading
id = "prd-overview"
level = 2
numbered = true
template = "Overview"

# @cpt:heading
id = "prd-overview-purpose"
level = 3
numbered = true
template = "Purpose"
```

Generated `template.md`:

```markdown
# PRD — {Title of product}

## 1. Overview

### 1.1 Purpose
```

---

## Usage

- **Generate workflows**: load `template.md` as structural reference when creating a new artifact
- **Validate workflows**: compare artifact headings against `template.md` structure (via constraints.toml)
- **Agent context**: agents use `template.md` to understand required sections without reading the full blueprint

---

## Error Handling

| Error | Cause | Resolution |
|-------|-------|------------|
| `TEMPLATE_GENERATION_FAILED` | Blueprint has no `@cpt:heading` markers | Add at least one `@cpt:heading` to blueprint |
| `TEMPLATE_NO_HEADINGS` | No `@cpt:heading` markers found | Add at least one `@cpt:heading` |
